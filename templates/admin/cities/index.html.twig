{% extends 'base.html.twig' %}

{% block title %}flights - Liste des villes{% endblock %}

{% block body %}

<section class="hero-table">
    <div class="hero-table-content">
        <h1>Villes</h1>
    </div>
</section>

<div class="d-flex justify-content-between align-items-center mb-3 p-3">
    <div class="d-flex gap-3 mb-4">
        <select id="sortByCity" class="form-select">
            <option value="az">Ville : A → Z</option>
            <option value="za">Ville : Z → A</option>
        </select>
        <select id="sortByCountry" class="form-select">
            <option value="az">Pays : A → Z</option>
            <option value="za">Pays : Z → A</option>
        </select>
    </div>
</div>

<section class="container pb-5">
    <div class="row justify-content-center">

        <div class="col-10">

                <table id="citiesTable" class="table">
                    <thead style="border-style:hidden;">
                        <tr>
                            <th class="title-info">Ville</td>
                            <th class="title-info">Pays</td>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for city in cities %}
                    
                        <tr data-city="{{ city.name }}" data-country="{{ city.country }}" style="vertical-align:middle;">
                        
                            <td>{{ city.name }}</td>
                            <td>{{ city.country }}</td>

                            <td class="d-flex actions">
                                <button class="btn edit-btn actions-size m-1" title="Modifier">
                                    <a href="{{ path('admin_cities_edit', {'id': city.id}) }}" style="text-decoration:none; color:#ffffff;">
                                        <i class="fa-solid fa-pen-to-square"></i>
                                    </a>
                                </button>

                                {{ include('admin/cities/_delete_form.html.twig') }}
                            </td>
                        </tr>
                        <tr class="spacer" style="height:50px;"></tr>
                    {% else %}
                        <tr>
                            <td colspan="2" style="padding:30px;text-align:left;">Aucunes villes enregistrées !<br>Ajoutez-en une nouvelle ici <i class="fa-solid fa-turn-down" style="color: #000000;"></i></td>
                        </tr>
                    {% endfor %}
                    </tbody>

                </table>

            <div class="btn-center">
                <a class="btn-slide slide-right" href="{{ path('admin_cities_new')}}" style="text-decoration:none;"><i class="fa-solid fa-plus p-2"></i>Créer une nouvelle ville</a>
            </div>
        </div>

    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const dataRows = Array.from(document.querySelectorAll('#citiesTable tbody tr[data-city]'));
    const tbody = document.querySelector('#citiesTable tbody');

    const sortByCity = document.getElementById('sortByCity');
    const sortByCountry = document.getElementById('sortByCountry');


    function updateTableByCity() {
        let sortedRows = [...dataRows];

        sortedRows.sort((a, b) => {
            const cityA = a.dataset.city.toLowerCase();
            const cityB = b.dataset.city.toLowerCase();

            if (sortByCity.value === 'az') {
                return cityA.localeCompare(cityB);
            } else if (sortByCity.value === 'za') {
                return cityB.localeCompare(cityA);
            }
        });
        //créer le tr vide pour l'espacement
        renderTable(sortedRows);
    }

    function updateTableByCountry() {
        let sortedRows = [...dataRows];

        sortedRows.sort((a, b) => {
            const countryA = a.dataset.country.toLowerCase();
            const countryB = b.dataset.country.toLowerCase();

            if (sortByCountry.value === 'az') {
                return countryA.localeCompare(countryB);
            } else if (sortByCountry.value === 'za') {
                return countryB.localeCompare(countryA);
            }
        });

        renderTable(sortedRows);
    }

    function renderTable(sortedRows) {

        tbody.classList.add('tr-fade');

        setTimeout(() => {
            tbody.innerHTML = '';
            sortedRows.forEach((row) => {
                tbody.appendChild(row);
                const spacer = document.createElement('tr');
                spacer.classList.add('spacer');
                spacer.innerHTML = '<td colspan="4" style="height:50px;"></td>';
                tbody.appendChild(spacer);
            });
            tbody.classList.remove('tr-fade');
        }, 300);
    }

    sortByCity.addEventListener('change', updateTableByCity);
    sortByCountry.addEventListener('change', updateTableByCountry);
});
</script>



{% endblock %}
