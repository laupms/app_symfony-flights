<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Flights plateforme gestion de vols aériens">
        <title>{% block title %}flights - Plateforme de gestion de vols aériens{% endblock %}</title>
        <link rel="icon" type:"image/png" href="{{asset('img/favicon.webp')}}">


        {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
        
        {% block stylesheets %}
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
            
            <script src="https://kit.fontawesome.com/57fead636f.js" crossorigin="anonymous"></script>
        {% endblock %}

        <link rel="stylesheet" href="{{asset('css/styles.css')}}">

        {# Gestion du consentement des cookies #}
        {# {% if app.request.cookies['cookie_consent'] == 'accepted' %}
            <!-- pour Google Analytics -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXX"></script>
            <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-XXXXXXX');
            </script>
        {% endif %} #}

    </head>

    <body>
        <nav class="navbar navbar-expand-sm" id="navbar">
            <div class="container-fluid">
                <div class="col-2">
                    <ul class="navbar-nav m-2">
                        <li>
                            <a href="{{ path('home') }}" style="text-decoration:none; color:#ffffff;"><img src="/img/logo-header.webp" alt="logo flights" style="max-width: 100px; width:100%;"></a>
                        </li>
                    </ul>
                </div>

                <div class="col-9">
                    <ul class="navbar-nav m-2" id="navLinks">
                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'home' ? 'active' : '' }}" href="{{ path('home')}}">Accueil</a>
                        </li>

                        <li class="nav-item">
                            {% if is_granted ('ROLE_ADMIN') %}
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'admin_flights' ? 'active' : '' }}" href="{{ path('admin_flights') }}">Vols</a>
                            {% else %}
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'app_flights_index' ? 'active' : '' }}" href="{{ path('app_flights_index')}}">Vols</a>
                            {% endif %}
                        </li>

                        {% if is_granted ('ROLE_ADMIN') %}
                        
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle no-caret" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Gestion<i class="fa-solid fa-chevron-down" style="font-size: 0.7em; margin-left: 4px;"></i></a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li class="nav-item">
                                    <a class="dropdown-item {{ app.request.attributes.get('_route') == 'admin_cities' ? 'active' : '' }}" href=" {{ path('admin_cities')}}">Villes</a>
                                </li>
                                <li class="nav-item">
                                    <a class="dropdown-item {{ app.request.attributes.get('_route') == 'admin_airline' ? 'active' : '' }}" href="{{ path('admin_airline')}}">Compagnies</a>
                                </li>
                                <li class="nav-item">
                                    <a class="dropdown-item {{ app.request.attributes.get('_route') == 'admin_airport' ? 'active' : '' }}" href="{{ path('admin_airport') }}">Aéroports</a>
                                </li>
                                <li class="nav-item">
                                    <a class="dropdown-item {{ app.request.attributes.get('_route') == 'admin_discount' ? 'active' : '' }}" href="{{ path('admin_discount')}}">Réductions</a>
                                </li>
                                <li class="nav-item">
                                    <a class="dropdown-item {{ app.request.attributes.get('_route') == 'admin_user' ? 'active' : '' }}" href="{{ path('admin_user')}}">Utilisateurs</a>
                                </li>
                            </ul>
                        </li>
                        {% endif %}

                        {% if is_granted ('ROLE_USER') %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle no-caret" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="background-color: #ffffff18; border-radius: 10px;"><i class="fa-solid fa-circle-user" style="color:#aad7aa; padding-right: 5px;" aria-hidden="true"></i>{{ app.user.username }}</a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                <li class="nav-item">
                                    <a class="dropdown-item" href="/logout" onclick="return confirm('Êtes-vous sûr(e) de vouloir vous déconnecter de votre session ?');"><i class="fa-solid fa-plane-arrival" aria-hidden="true"></i> Me déconnecter</a>
                                </li>
                            </ul>
                        </li>
                        {% else %}

                        <li class="nav-item">
                            <a class="nav-link {{ app.request.attributes.get('_route') == 'app_login' ? 'active' : '' }}" href="/login"><i class="fa-solid fa-plane-departure"></i> Connexion</a>
                        </li>
                        {% endif %}

                    </ul>
                </div>

                <div class="col-1">
                    <button class="burger" id="burger"
                        aria-controls="navLinks"
                        aria-expanded="false"
                        aria-label="Ouvrir le menu de navigation">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </button>
                </div>
        </nav>

        {% block body %}
        {% endblock %}

        
        {% if app.request.cookies['cookie_consent'] is not defined %}
            <div id="cookie-banner" style="
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: #222;
                color: #fff;
                padding: 15px;
                text-align: center;
                z-index: 9999;">

                <p><i class="fa-solid fa-cookie-bite" aria-hidden="true"></i> Nous utilisons des cookies pour améliorer votre expérience.
                    <a href="{{ path('politique-confidentialite') }}" style="color:#6b6b6b;">En savoir plus</a>.
                </p>
                <button alt="Accepter les cookies" id="acceptCookies" class="btn btn-slide-accept slide-accept btn-sm m-1" style="background-color:#004c00;">Accepter</button>
                <button alt="Refuser les cookies" id="rejectCookies" class="btn btn-slide-refuse slide-refuse btn-sm m-1" style="background-color:#a12d2d;">Refuser</button>
            </div>
        {% endif %}


        <footer>

            <nav class="navbar navbar-expand-sm bg navbar position-relative flex-column" style="bottom:0;">
                <div class="container-fluid justify-content-between footer-size">

                    <ul class="m-2 nav-footer" style="padding-left:0;">
                        <li class="nav-footer-item"><a class="nav-link" href="{{ path('mentions-legales') }}">Mentions légales</a></li>
                        <li class="nav-footer-item"><a class="nav-link" href="{{ path('cgu') }}">Conditions d'utilisation</a></li>
                        <li class="nav-footer-item"><a class="nav-link" href="{{ path('politique-confidentialite') }}">Politique de confidentialité et des cookies</a></li>
                        <li class="nav-footer-item"><a class="nav-link" href="#" onclick="document.getElementById('cookie-banner').style.display='block'">Gérer mes cookies</a></li>

                    </ul>
                    <ul class="navbar-nav m-2 text-center" style="align-items:center;">
                        <li class="nav-item">
                            <h2 class="m-3"><a class="nav-link" href="{{ path('home')}}"><img class="logo-footer" src="/img/logo-footer.webp" alt="logo flights"></a></h2>
                        </li>
                    </ul>

                </div>
                <p class="pt-3" style="color:#ffffff; font-size:10px;">© 2025 flights - Tous droits réservés</p>

            </nav>

            {% block javascripts %}

                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>


                <script> 

                //Menu burger

                    document.addEventListener('DOMContentLoaded', () => {
                        const burger = document.getElementById('burger');
                        const nav = document.getElementById('navLinks');

                        // Toggle ouverture/fermeture
                        burger.addEventListener('click', () => {
                            const expanded = burger.getAttribute('aria-expanded') === 'true';
                            burger.setAttribute('aria-expanded', !expanded);
                            nav.classList.toggle('active');
                        });

                        // Fermer le menu quand on clique ailleurs
                        document.addEventListener('click', (e) => {
                            if (!nav.contains(e.target) && !burger.contains(e.target)) {
                            nav.classList.remove('active');
                            burger.setAttribute('aria-expanded', 'false');
                            }
                        });

                        // Fermer avec la touche Échap
                        document.addEventListener('keydown', (e) => {
                            if (e.key === 'Escape') {
                            nav.classList.remove('active');
                            burger.setAttribute('aria-expanded', 'false');
                            burger.focus(); // Retourne le focus au bouton
                            }
                        });
                    });



                //Bannière cookies

                    document.addEventListener('DOMContentLoaded', function() {
                        const banner = document.getElementById('cookie-banner');
                        const accept = document.getElementById('acceptCookies');
                        const reject = document.getElementById('rejectCookies');

                        function setCookie(name, value, days) {
                            const date = new Date();
                            date.setTime(date.getTime() + (days*24*60*60*1000));
                            document.cookie = name + "=" + value + ";expires=" + date.toUTCString() + ";path=/";
                        }

                        accept.addEventListener('click', () => {
                            setCookie('cookie_consent', 'accepted', 365);
                            banner.style.display = 'none';
                            //location.reload(); // recharge page si Google Analytics (ou autre) activé
                        });

                        reject.addEventListener('click', () => {
                            setCookie('cookie_consent', 'rejected', 365);
                            banner.style.display = 'none';
                        });
                    });

                </script>

            {% endblock %}



        </footer>

    </body>

</html>
